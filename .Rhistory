})
alpha = 1 - 0.95
stat = data %>%
filter(any > 0) %>%
group_by(category, type) %>%
m = lm(formula = log(eal / pop) ~ log(den + 0.01) + log(pop) + log(area) + crf )
alpha = 1 - 0.95
stat = data %>%
filter(any > 0) %>%
group_by(category, type) %>%
reframe(
# RISK ~ COUNT + POPULATION + AREA
{
m = lm(formula = log(eal / pop) ~ log(den + 0.01) + log(pop) + log(area) + crf )
print(summary(m))
newdata = tibble(
den = quantile(den, na.rm = TRUE, prob = pden),
pop = quantile(pop, na.rm = TRUE, prob = ppop),
area = quantile(area, na.rm = TRUE, prob = parea),
crf = quantile(crf, na.rm = TRUE, prob = pcrf)
)
y0 = predict(m, newdata = newdata)
y1 = predict(m, newdata = newdata %>% mutate(den = den + x) )
se = broom::glance(m)$sigma
tibble(y0 = y0, y1 = y1, se = se)
})
alpha = 1 - 0.95
stat = data %>%
filter(any > 0) %>%
group_by(category, type) %>%
reframe(
# RISK ~ COUNT + POPULATION + AREA
{
m = lm(formula = log(eal / pop) ~ log(den + 0.01) + log(pop) + log(area) + crf )
print(summary(m))
newdata = tibble(
den = quantile(den, na.rm = TRUE, prob = 0.5),
pop = quantile(pop, na.rm = TRUE, prob = 0.5),
area = quantile(area, na.rm = TRUE, prob = 0.5),
crf = quantile(crf, na.rm = TRUE, prob = 0.5)
)
#y0 = predict(m, newdata = newdata)
#y1 = predict(m, newdata = newdata %>% mutate(den = den + x) )
se = broom::glance(m)$sigma
tibble(y0 = y0, y1 = y1, se = se)
})
alpha = 1 - 0.95
stat = data %>%
filter(any > 0) %>%
group_by(category, type) %>%
reframe(
# RISK ~ COUNT + POPULATION + AREA
{
m = lm(formula = log(eal / pop) ~ log(den + 0.01) + log(pop) + log(area) + crf )
print(summary(m))
newdata = tibble(
den = quantile(den, na.rm = TRUE, prob = 0.5),
pop = quantile(pop, na.rm = TRUE, prob = 0.5),
area = quantile(area, na.rm = TRUE, prob = 0.5),
crf = quantile(crf, na.rm = TRUE, prob = 0.5)
)
y0 = predict(m, newdata = newdata)
#y1 = predict(m, newdata = newdata %>% mutate(den = den + x) )
se = broom::glance(m)$sigma
tibble(y0 = y0, y1 = y1, se = se)
})
alpha = 1 - 0.95
stat = data %>%
filter(any > 0) %>%
group_by(category, type) %>%
reframe(
# RISK ~ COUNT + POPULATION + AREA
{
m = lm(formula = log(eal / pop) ~ log(den + 0.01) + log(pop) + log(area) + crf )
print(summary(m))
newdata = tibble(
den = quantile(den, na.rm = TRUE, prob = 0.5),
pop = quantile(pop, na.rm = TRUE, prob = 0.5),
area = quantile(area, na.rm = TRUE, prob = 0.5),
crf = quantile(crf, na.rm = TRUE, prob = 0.5)
)
y0 = predict(m, newdata = newdata)
y1 = predict(m, newdata = newdata %>% mutate(den = den + 1) )
se = broom::glance(m)$sigma
tibble(y0 = y0, y1 = y1, se = se)
})
alpha = 1 - 0.95
stat = data %>%
filter(any > 0) %>%
group_by(category, type) %>%
reframe(
# RISK ~ COUNT + POPULATION + AREA
{
m = lm(formula = log(eal / pop) ~ log(den + 0.01) + log(pop) + log(area) + crf )
print(summary(m))
newdata = tibble(
den = quantile(den, na.rm = TRUE, prob = 0.5),
pop = quantile(pop, na.rm = TRUE, prob = 0.5),
area = quantile(area, na.rm = TRUE, prob = 0.5),
crf = quantile(crf, na.rm = TRUE, prob = 0.5)
)
y0 = predict(m, newdata = newdata)
y1 = predict(m, newdata = newdata %>% mutate(den = den + 1) )
se = broom::glance(m)$sigma
tibble(y0 = y0, y1 = y1, se = se)
})
alpha = 1 - 0.95
stat = data %>%
filter(any > 0) %>%
group_by(category, type) %>%
reframe(
# RISK ~ COUNT + POPULATION + AREA
{
m = lm(formula = log(eal / pop) ~ log(den + 0.01) + log(pop) + log(area) + crf )
print(summary(m))
newdata = tibble(
den = quantile(den, na.rm = TRUE, prob = 0.5),
pop = quantile(pop, na.rm = TRUE, prob = 0.5),
area = quantile(area, na.rm = TRUE, prob = 0.5),
crf = quantile(crf, na.rm = TRUE, prob = 0.5)
)
y0 = predict(m, newdata = newdata)
y1 = predict(m, newdata = newdata %>% mutate(den = den + 1) )
se = broom::glance(m)$sigma
tibble(y0 = y0, y1 = y1, se = se)
})
alpha = 1 - 0.95
stat = data %>%
filter(any > 0) %>%
group_by(category, type) %>%
reframe(
# RISK ~ COUNT + POPULATION + AREA
{
m = lm(formula = log(eal / pop) ~ log(den + 0.01) + log(pop) + log(area) + crf )
print(summary(m))
newdata = tibble(
den = quantile(den, na.rm = TRUE, prob = 0.5),
pop = quantile(pop, na.rm = TRUE, prob = 0.5),
area = quantile(area, na.rm = TRUE, prob = 0.5),
crf = quantile(crf, na.rm = TRUE, prob = 0.5)
)
y0 = predict(m, newdata = newdata)
y1 = predict(m, newdata = newdata %>% mutate(den = den + 1) )
se = broom::glance(m)$sigma
tibble(y0 = y0, y1 = y1, se = se)
})
alpha = 1 - 0.95
stat = data %>%
filter(any > 0) %>%
group_by(category, type) %>%
reframe(
# RISK ~ COUNT + POPULATION + AREA
{
m = lm(formula = log(eal / pop) ~ log(den + 0.01) + log(pop) + log(area) + crf )
print(summary(m))
newdata = tibble(
den = quantile(den, na.rm = TRUE, prob = 0.5),
pop = quantile(pop, na.rm = TRUE, prob = 0.5),
area = quantile(area, na.rm = TRUE, prob = 0.5),
crf = quantile(crf, na.rm = TRUE, prob = 0.5)
)
y0 = predict(m, newdata = newdata)
y1 = predict(m, newdata = newdata %>% mutate(den = den + 1) )
se = broom::glance(m)$sigma
tibble(y0 = y0, y1 = y1, se = se)
})
alpha = 1 - 0.95
stat = data %>%
filter(any > 0) %>%
group_by(category, type) %>%
reframe(
# RISK ~ COUNT + POPULATION + AREA
{
m = lm(formula = log(eal / pop) ~ log(den + 0.01) + log(pop) + log(area) + crf )
print(summary(m))
newdata = tibble(
den = quantile(den, na.rm = TRUE, prob = 0.5),
pop = quantile(pop, na.rm = TRUE, prob = 0.5),
area = quantile(area, na.rm = TRUE, prob = 0.5),
crf = quantile(crf, na.rm = TRUE, prob = 0.5)
)
y0 = predict(m, newdata = newdata)
y1 = predict(m, newdata = newdata %>% mutate(den = den + 1) )
se = broom::glance(m)$sigma
tibble(y0 = y0, y1 = y1, se = se)
})
alpha = 1 - 0.95
stat = data %>%
filter(any > 0) %>%
group_by(category, type) %>%
reframe(
# RISK ~ COUNT + POPULATION + AREA
{
m = lm(formula = log(eal / pop) ~ log(den + 0.01) + log(pop) + log(area) + crf )
print(summary(m))
newdata = tibble(
den = quantile(den, na.rm = TRUE, prob = 0.5),
pop = quantile(pop, na.rm = TRUE, prob = 0.5),
area = quantile(area, na.rm = TRUE, prob = 0.5),
crf = quantile(crf, na.rm = TRUE, prob = 0.5)
)
y0 = predict(m, newdata = newdata)
y1 = predict(m, newdata = newdata %>% mutate(den = den + 2) )
se = broom::glance(m)$sigma
tibble(y0 = y0, y1 = y1, se = se)
})
data %>%
filter(any > 0) %>%
group_by(category, type) %>%
reframe(
lm(formula = log(eal / pop) ~ log(den) + log(pop) + log(area) + I(risk / eal) ) %>%
broom::tidy() %>%
filter(term == "log(den)")
) %>%
mutate(stars = gtools::stars.pval(p.value))
data %>%
filter(any > 0) %>%
group_by(category, type) %>%
reframe(
lm(formula = log(eal / pop) ~ log(den) + log(pop) + log(area) + I(risk / eal) ) %>%
broom::tidy() %>%
filter(term == "log(den)")
) %>%
mutate(stars = gtools::stars.pval(p.value)) %>% summary()
data %>%
filter(any > 0) %>%
group_by(category, type) %>%
reframe(
lm(formula = log(eal / pop) ~ log(den) + log(pop) + log(area) + I(risk / eal) ) %>%
broom::tidy() %>%
filter(term == "log(den)")
) %>%
mutate(stars = gtools::stars.pval(p.value)) %>% glance()
data %>%
filter(any > 0) %>%
group_by(category, type) %>%
reframe({
# Fit model for each group
m <- lm(log(eal / pop) ~ log(den) + log(pop) + log(area) + I(risk / eal), data = cur_data())
# Extract key model summaries
tidy_df   <- broom::tidy(m)
glance_df <- broom::glance(m)
# Select coefficient of interest (log(den))
beta_row <- tidy_df %>% filter(term == "log(den)")
tibble(
n        = glance_df$nobs,              # sample size
beta     = beta_row$estimate,           # coefficient
se       = beta_row$std.error,          # std. error (optional)
p.value  = beta_row$p.value,            # p-value (optional)
r.sq     = glance_df$r.squared,         # R²
rmse     = glance_df$sigma,             # residual std. error = RMSE
stars    = gtools::stars.pval(beta_row$p.value)
)
})
data %>%
filter(any > 0) %>%
#group_by(category, type) %>%
reframe({
# Fit model for each group
m <- lm(log(eal / pop) ~ log(den) + log(pop) + log(area) + I(risk / eal), data = cur_data())
# Extract key model summaries
tidy_df   <- broom::tidy(m)
glance_df <- broom::glance(m)
# Select coefficient of interest (log(den))
beta_row <- tidy_df %>% filter(term == "log(den)")
tibble(
n        = glance_df$nobs,              # sample size
beta     = beta_row$estimate,           # coefficient
se       = beta_row$std.error,          # std. error (optional)
p.value  = beta_row$p.value,            # p-value (optional)
r.sq     = glance_df$r.squared,         # R²
rmse     = glance_df$sigma,             # residual std. error = RMSE
stars    = gtools::stars.pval(beta_row$p.value)
)
})
# Define dependent and independent variable sets
dep_vars <- c("eal", "risk")       # or whatever outcomes you have
indep_vars <- c("den", "pop", "area", "crf")  # predictors you want to test
# Create all combinations
combos <- tidyr::expand_grid(dep = dep_vars, indep = indep_vars)
# Fit models for each dep/indep pair
results <- combos %>%
mutate(
model_info = map2(dep, indep, function(y, x) {
formula_str <- paste0("log(", y, " / pop) ~ log(", x, ") + log(pop) + log(area) + I(risk / eal)")
m <- lm(as.formula(formula_str), data = data %>% filter(any > 0))
tidy_df   <- broom::tidy(m)
glance_df <- broom::glance(m)
beta_row <- tidy_df %>% filter(term == paste0("log(", x, ")"))
tibble(
dep_var  = y,
indep_var = x,
n        = glance_df$nobs,
beta     = beta_row$estimate,
se       = beta_row$std.error,
p.value  = beta_row$p.value,
stars    = gtools::stars.pval(beta_row$p.value),
r.sq     = glance_df$r.squared,
rmse     = glance_df$sigma
)
})
) %>%
unnest(model_info)
View(results)
# Define dependent and independent variable sets
dep_vars <- c("eal")
indep_vars <- c("den", "pop", "area", "crf")  # predictors you want to test
# Create all combinations
combos <- tidyr::expand_grid(dep = dep_vars, indep = indep_vars)
# Fit models for each dep/indep pair
results <- combos %>%
mutate(
model_info = map2(dep, indep, function(y, x) {
formula_str <- paste0("log(", y, " / pop) ~ log(", x, ") + log(pop) + log(area) + log(crf)")
m <- lm(as.formula(formula_str), data = data %>% filter(any > 0))
tidy_df   <- broom::tidy(m)
glance_df <- broom::glance(m)
beta_row <- tidy_df %>% filter(term == paste0("log(", x, ")"))
tibble(
dep_var  = y,
indep_var = x,
n        = glance_df$nobs,
beta     = beta_row$estimate,
se       = beta_row$std.error,
p.value  = beta_row$p.value,
stars    = gtools::stars.pval(beta_row$p.value),
r.sq     = glance_df$r.squared,
rmse     = glance_df$sigma
)
})
) %>%
unnest(model_info)
dep_vars <- c("eal")
indep_vars <- c("den", "pop", "area", "risk","eal")  # predictors you want to test
# Create all combinations
combos <- tidyr::expand_grid(dep = dep_vars, indep = indep_vars)
# Fit models for each dep/indep pair
results <- combos %>%
mutate(
model_info = map2(dep, indep, function(y, x) {
formula_str <- paste0("log(", y, " / pop) ~ log(", x, ") + log(pop) + log(area) + I(risk / eal)")
m <- lm(as.formula(formula_str), data = data %>% filter(any > 0))
tidy_df   <- broom::tidy(m)
glance_df <- broom::glance(m)
beta_row <- tidy_df %>% filter(term == paste0("log(", x, ")"))
tibble(
dep_var  = y,
indep_var = x,
n        = glance_df$nobs,
beta     = beta_row$estimate,
se       = beta_row$std.error,
p.value  = beta_row$p.value,
stars    = gtools::stars.pval(beta_row$p.value),
r.sq     = glance_df$r.squared,
rmse     = glance_df$sigma
)
})
) %>%
unnest(model_info)
data %>%
filter(any > 0) %>%
reframe({
# Fit model for each group
m <- lm(log(eal / pop) ~ log(den) + log(pop) + log(area) + I(risk / eal), data = cur_data())
# Extract key model summaries
tidy_df   <- broom::tidy(m)
glance_df <- broom::glance(m)
# Select coefficient of interest (log(den))
beta_row <- tidy_df %>% filter(term == "log(den)")
tibble(
n        = glance_df$nobs,              # sample size
beta     = beta_row$estimate,           # coefficient
se       = beta_row$std.error,          # std. error (optional)
p.value  = beta_row$p.value,            # p-value (optional)
r.sq     = glance_df$r.squared,         # R²
rmse     = glance_df$sigma,             # residual std. error = RMSE
stars    = gtools::stars.pval(beta_row$p.value)
)
})
results <- combos %>%
mutate(
model_info = map2(dep, indep, function(y, x) {
formula_str <- paste0("log(", y, " / pop) ~ log(", x, ") + log(pop) + log(area) + I(risk / eal)")
m <- lm(as.formula(formula_str), data = data %>% filter(any > 0))
tidy_df   <- broom::tidy(m)
glance_df <- broom::glance(m)
# compute descriptive stats
dep_mean <- mean(df[[y]], na.rm = TRUE)
dep_sd   <- sd(df[[y]], na.rm = TRUE)
indep_mean <- mean(df[[x]], na.rm = TRUE)
indep_sd   <- sd(df[[x]], na.rm = TRUE)
beta_row <- tidy_df %>% filter(term == paste0("log(", x, ")"))
tibble(
dep_var  = y,
indep_var = x,
n        = glance_df$nobs,
beta     = beta_row$estimate,
se       = beta_row$std.error,
p.value  = beta_row$p.value,
stars    = gtools::stars.pval(beta_row$p.value),
r.sq     = glance_df$r.squared,
rmse     = glance_df$sigma,
dep_mean  = dep_mean,
dep_sd    = dep_sd,
indep_mean = indep_mean,
indep_sd   = indep_sd
)
})
) %>%
unnest(model_info)
results <- combos %>%
mutate(
model_info = map2(dep, indep, function(y, x) {
df <- data %>% filter(any > 0)
# compute descriptive stats
dep_mean <- mean(df[[y]], na.rm = TRUE)
dep_sd   <- sd(df[[y]], na.rm = TRUE)
indep_mean <- mean(df[[x]], na.rm = TRUE)
indep_sd   <- sd(df[[x]], na.rm = TRUE)
formula_str <- paste0("log(", y, " / pop) ~ log(", x, ") + log(pop) + log(area) + I(risk / eal)")
m <- lm(as.formula(formula_str), data = data %>% filter(any > 0))
tidy_df   <- broom::tidy(m)
glance_df <- broom::glance(m)
beta_row <- tidy_df %>% filter(term == paste0("log(", x, ")"))
tibble(
dep_var  = y,
indep_var = x,
n        = glance_df$nobs,
beta     = beta_row$estimate,
se       = beta_row$std.error,
p.value  = beta_row$p.value,
stars    = gtools::stars.pval(beta_row$p.value),
r.sq     = glance_df$r.squared,
rmse     = glance_df$sigma,
dep_mean  = dep_mean,
dep_sd    = dep_sd,
indep_mean = indep_mean,
indep_sd   = indep_sd
)
})
) %>%
unnest(model_info)
# Load packages
library(sf)
library(tigris)
library(stringr)
library(tidyverse)
library(broom.mixed)
library(readr)
library(dplyr)
library(ggplot2)
library(units)
#-----------------------------------------------------------------Filtered Data-set--------------------------------------------------------------------------------------------------------------------------------------
Filtered_Dataset_den <- readRDS("Datasets/Filtered_Dataset_den.rds")#Per capita, tracts from 25 cities, (1000 people)
Filtered_Dataset_aden <- readRDS("Datasets/Filtered_Dataset_aden.rds")#Per area, tracts from 25 cities, (Sq. Miles)
Filtered_Dataset_den2 <- readRDS("Datasets/Filtered_Dataset_den2.rds")#Per capita, all census tracts, (1000 people)
Filtered_Dataset_aden2 <- readRDS("Datasets/Filtered_Dataset_aden2.rds")#Per area, all census tracts, (Sq. Miles)
#--------------------------------------------------------------Summary Stats---------------------------------------------------------------------------------------------------------------------------------------------
#Evaluating the Variability per Type of Infrastructure--------------------------
#Per Capita
stats_den= Filtered_Dataset_den %>%
group_by(den_type,year,STATE, COUNTY,city) %>%
#Note the NANDA dataset holds information from 1990-2021 whilst the NRI scores only capture the most
#recent risk scores from Mar-2023
summarise(
mean_Infra_Den = mean(Infrastructure_Density, na.rm = TRUE),
sd_Infra_Den = sd(Infrastructure_Density, na.rm = TRUE),
mean_RISK_VALUE = mean(RISK_VALUE, na.rm = TRUE),
sd_RISK_VALUE = sd(RISK_VALUE, na.rm = TRUE)
)
Filtered_Dataset_den
View(Filtered_Dataset_den)
stats_den= Filtered_Dataset_den %>%
group_by(den_type,year,STATE, COUNTY,city) %>%
#Note the NANDA dataset holds information from 1990-2021 whilst the NRI scores only capture the most
#recent risk scores from Mar-2023
summarise(
mean_Infra_Den = mean(Infrastructure_Density, na.rm = TRUE),
sd_Infra_Den = sd(Infrastructure_Density, na.rm = TRUE),
mean_RISK_VALUE = mean(RISK_VALUE, na.rm = TRUE),
sd_RISK_VALUE = sd(RISK_VALUE, na.rm = TRUE),
max_EAL = max(RISK_VALUE/CRF_VALUE, na.rm = TRUE),
mib_EAL = min(RISK_VALUE/CRF_VALUE, na.rm = TRUE),
max_EAL_VALB = max(EAL_VALB, na.rm = TRUE),
mib_EAL_VALB = min(EAL_VALB, na.rm = TRUE),
)
View(stats_den)
stats_den= Filtered_Dataset_den %>%
group_by(den_type,year,STATE, COUNTY,city) %>%
#Note the NANDA dataset holds information from 1990-2021 whilst the NRI scores only capture the most
#recent risk scores from Mar-2023
summarise(
mean_Infra_Den = mean(Infrastructure_Density, na.rm = TRUE),
sd_Infra_Den = sd(Infrastructure_Density, na.rm = TRUE),
mean_RISK_VALUE = mean(RISK_VALUE, na.rm = TRUE),
sd_RISK_VALUE = sd(RISK_VALUE, na.rm = TRUE),
max_EAL = max(RISK_VALUE/CRF_VALUE, na.rm = TRUE),
min_EAL = min(RISK_VALUE/CRF_VALUE, na.rm = TRUE),
max_EAL_VALB = max(EAL_VALB, na.rm = TRUE),
min_EAL_VALB = min(EAL_VALB, na.rm = TRUE),
)
stats_den$min_EAL>0
min(stats_den$min_EAL>0)
min(stats_den$min_EAL<0)
min(stats_den$min_EAL[stats_den$min_EAL<0])
min(stats_den$min_EAL[stats_den$min_EAL>0])
max(stats_den$max_EAL)
min(stats_den$min_EAL[stats_den$min_EAL>0])
git remote -v
system("git remote -v")
system("git remote set-url origin <https://github.com/rhughes74/SI_Effects_on_NRI_Risk>")
system("git remote -v")
